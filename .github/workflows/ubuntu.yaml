name: ubuntu
on: [push]

jobs:
  main:
    name: main
    runs-on: ubuntu-${{ matrix.os-version }}

    strategy:
      matrix:
        os-version:
          - '16.04'
          - '18.04'
        python-version:
          - '2.7'
          - '3.6'
          - '3.7'

    steps:
      - name: Checkout
        uses: actions/checkout@v1
        with:
          fetch-depth: 1

      - name: Set up Python ${{ matrix.python-version }}
        uses: actions/setup-python@v1
        with:
          python-version: ${{ matrix.python-version }}

      - name: Install csh
        run: |
          sudo apt-get install csh

      - name: Install tcsh
        run: |
          sudo apt-get install tcsh

      - name: Install zsh
        run: |
          sudo apt-get install zsh

      # https://docs.microsoft.com/en-us/powershell/scripting/install/installing-powershell-core-on-linux?view=powershell-6
      - name: Install pwsh
        run: |
          wget -q https://packages.microsoft.com/config/ubuntu/${{ matrix.os-version }}/packages-microsoft-prod.deb
          sudo dpkg -i packages-microsoft-prod.deb
          sudo apt-get update
          sudo apt-get install -y powershell

      - name: Install Rez
        run: |
          mkdir ./build
          python ./install.py ./build

      - name: Run Rez Tests
        run: |
          ./build/bin/rez/rez-selftest -s bash
